name: Publish Libraries

on:
  workflow_call:
    secrets:
      nuget_api_key:
        description: 'nuget.org API key'
        required: true

jobs:
  publish-nuget:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v3
      with:
        fetch-depth: 0
    - name: Setup .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: 6.0.x
    - name: Download .NET Core .nupkg packages
      uses: actions/download-artifact@v3
      with:
        name: libs.core
        path: ${{ github.workspace }}/packages/
    - name: Download .NET WebForms .nupkg packages
      uses: actions/download-artifact@v3
      with:
        name: libs.webforms
        path: ${{ github.workspace }}/packages/
    - name: List packages
      shell: pwsh
      run: >
        Get-ChildItem -Path "${{ github.workspace }}/packages/"
        | Foreach-Object Process
            {
                echo $_.Name
            }
    - name: Publish NuGet packages to nuget.org
      uses: myci-actions/publish-nuget@5
      with:
        filename: '{{ github.workspace }}/packages/*.nupkg'
        api-key: "no" # ${{ secrets.nuget_api_key }}